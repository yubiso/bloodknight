<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BloodKnight | Defend the Pulse</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts: Inter & Rajdhani -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <style>
        :root {
            --primary-red: #dc2626;
            --dark-slate: #0f172a;
        }

        body {
            font-family: 'Inter', sans-serif;
        }

        h1, h2, h3, h4, .tactical-font {
            font-family: 'Rajdhani', sans-serif;
        }

        /* --- Animations & Effects --- */
        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); }
            50% { box-shadow: 0 0 0 15px rgba(220, 38, 38, 0); }
        }
        
        .animate-pulse-red { animation: pulse-red 2s infinite; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .image-card-hover { transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .image-card-hover:hover {
            transform: translateY(-5px) scale(1.01);
            box-shadow: 0 20px 25px -5px rgba(220, 38, 38, 0.15);
        }

        .hidden-section { display: none !important; }
        
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Modal Overlay */
        .modal-overlay {
            background-color: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(5px);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        ::selection { background-color: #fee2e2; color: #7f1d1d; }
    </style>
</head>
<body class="bg-white font-sans text-slate-900 selection:bg-red-100 selection:text-red-900">

    <!-- Navigation Bar -->
    <nav class="sticky top-0 z-40 w-full bg-white/90 backdrop-blur-lg border-b border-slate-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <!-- Logo -->
                <div class="flex items-center cursor-pointer group" onclick="navigateTo('home')">
                    <div class="relative mr-3">
                        <i class="fas fa-shield-alt text-3xl text-slate-800 group-hover:text-slate-900 transition-colors"></i>
                        <i class="fas fa-tint text-red-600 absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-sm"></i>
                    </div>
                    <span class="text-2xl font-bold tactical-font text-slate-900 tracking-tighter uppercase group-hover:text-red-700 transition-colors">
                        Blood<span class="text-red-600">Knight</span>
                    </span>
                </div>

                <!-- Desktop Nav Links -->
                <div class="hidden md:flex space-x-8 items-center">
                    <button onclick="navigateTo('home')" class="nav-link text-sm font-bold uppercase tracking-wide transition-colors text-red-700 hover:text-red-600" data-target="home">Headquarters</button>
                    <button onclick="navigateTo('eligibility')" class="nav-link text-sm font-bold uppercase tracking-wide transition-colors text-slate-500 hover:text-red-600" data-target="eligibility">Check Status</button>
                    <button onclick="navigateTo('donate')" class="nav-link text-sm font-bold uppercase tracking-wide transition-colors text-slate-500 hover:text-red-600" data-target="donate">Missions</button>
                    <button onclick="navigateTo('supply')" class="nav-link text-sm font-bold uppercase tracking-wide transition-colors text-slate-500 hover:text-red-600" data-target="supply">Supply</button>
                </div>

                <!-- Auth / Profile Section -->
                <div class="hidden md:flex items-center space-x-4" id="auth-container-desktop">
                    <!-- Default State: Join Button -->
                    <button onclick="openAuthModal()" id="btn-join-desktop" class="bg-red-700 text-white hover:bg-red-800 shadow-lg shadow-red-200 border border-red-700 px-6 py-2.5 rounded-lg font-bold uppercase tracking-wider text-sm transition-all transform hover:-translate-y-0.5 flex items-center">
                        <i class="fas fa-sign-in-alt mr-2"></i> Login
                    </button>

                    <!-- Logged In State: Profile (Hidden by default) -->
                    <div id="profile-desktop" class="hidden flex items-center space-x-3 cursor-pointer group" onclick="navigateTo('recruitment')">
                        <div class="text-right hidden lg:block">
                            <p class="text-xs text-slate-400 uppercase font-bold tracking-wider">Commander</p>
                            <p class="text-sm font-black text-slate-900 group-hover:text-red-600 transition-colors" id="username-display-desktop">User</p>
                        </div>
                        <div class="h-10 w-10 rounded-full bg-slate-200 border-2 border-white shadow-md overflow-hidden relative">
                             <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Avatar" class="object-cover w-full h-full">
                        </div>
                    </div>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button onclick="toggleMobileMenu()" class="text-slate-500 hover:text-slate-900 p-2">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-b border-slate-200 px-4 py-2 shadow-xl absolute w-full z-50">
            <button onclick="navigateTo('home'); toggleMobileMenu()" class="block w-full text-left py-4 text-slate-600 font-bold uppercase hover:text-red-600 border-b border-slate-100">Headquarters</button>
            <button onclick="navigateTo('eligibility'); toggleMobileMenu()" class="block w-full text-left py-4 text-slate-600 font-bold uppercase hover:text-red-600 border-b border-slate-100">Check Status</button>
            <button onclick="navigateTo('donate'); toggleMobileMenu()" class="block w-full text-left py-4 text-slate-600 font-bold uppercase hover:text-red-600 border-b border-slate-100">Missions</button>
            <button onclick="navigateTo('supply'); toggleMobileMenu()" class="block w-full text-left py-4 text-slate-600 font-bold uppercase hover:text-red-600 border-b border-slate-100">Supply</button>
            <button onclick="navigateTo('community'); toggleMobileMenu()" class="block w-full text-left py-4 text-slate-600 font-bold uppercase hover:text-red-600 border-b border-slate-100">Squadrons</button>
            
            <div id="auth-container-mobile" class="py-4">
                <button onclick="openAuthModal(); toggleMobileMenu()" id="btn-join-mobile" class="w-full bg-red-700 text-white px-6 py-3 rounded-lg font-bold uppercase tracking-wider text-sm">Login / Join</button>
                <div id="profile-mobile" class="hidden flex items-center space-x-3 p-2 bg-slate-50 rounded-lg" onclick="navigateTo('recruitment'); toggleMobileMenu()">
                     <div class="h-10 w-10 rounded-full bg-slate-200 border border-slate-300 overflow-hidden">
                         <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-full h-full">
                     </div>
                     <div>
                        <p class="text-xs text-slate-400 uppercase font-bold">Logged in as</p>
                        <p class="text-sm font-black text-slate-900" id="username-display-mobile">Commander</p>
                     </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- === AUTH MODAL === -->
    <div id="auth-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 modal-overlay transition-opacity" onclick="closeAuthModal()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-4">
            <div class="bg-white rounded-2xl shadow-2xl overflow-hidden animate-fade-in">
                <div class="flex">
                    <button onclick="switchAuthTab('login')" id="tab-login" class="flex-1 py-4 text-sm font-bold uppercase tracking-wider bg-white text-red-700 border-b-2 border-red-700">Login</button>
                    <button onclick="switchAuthTab('register')" id="tab-register" class="flex-1 py-4 text-sm font-bold uppercase tracking-wider bg-slate-50 text-slate-400 border-b border-slate-200 hover:text-slate-600">Register</button>
                </div>
                
                <div class="p-8">
                    <div class="text-center mb-8">
                        <i class="fas fa-shield-alt text-4xl text-red-600 mb-2"></i>
                        <h3 class="text-2xl font-black tactical-font text-slate-900 uppercase" id="auth-title">Welcome Back</h3>
                        <p class="text-slate-500 text-sm">Enter your credentials to access the mainframe.</p>
                    </div>

                    <form onsubmit="handleAuth(event)" class="space-y-4">
                        <div id="register-fields" class="hidden space-y-4">
                            <div>
                                <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Codename</label>
                                <input type="text" id="auth-name" class="w-full px-4 py-3 rounded-lg bg-slate-50 border border-slate-200 focus:border-red-500 focus:ring-1 focus:ring-red-500 outline-none font-medium" placeholder="e.g. Viper">
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Email Frequency</label>
                            <input type="email" required class="w-full px-4 py-3 rounded-lg bg-slate-50 border border-slate-200 focus:border-red-500 focus:ring-1 focus:ring-red-500 outline-none font-medium" placeholder="user@bloodknight.my">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Security Key</label>
                            <input type="password" required class="w-full px-4 py-3 rounded-lg bg-slate-50 border border-slate-200 focus:border-red-500 focus:ring-1 focus:ring-red-500 outline-none font-medium" placeholder="••••••••">
                        </div>
                        <button type="submit" class="w-full bg-red-700 text-white py-4 rounded-lg font-bold uppercase tracking-wider shadow-lg shadow-red-100 hover:bg-red-800 transform transition hover:-translate-y-0.5">
                            <span id="auth-btn-text">Identify</span> <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- === SQUAD MODAL (New) === -->
    <div id="squad-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 modal-overlay transition-opacity" onclick="closeSquadModal()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-4">
            <div class="bg-white rounded-2xl shadow-2xl overflow-hidden animate-fade-in border border-slate-200">
                <div class="bg-slate-900 p-6 text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fas fa-users text-6xl"></i></div>
                    <h3 class="text-2xl font-black tactical-font uppercase mb-1">Squadron Registry</h3>
                    <p class="text-slate-400 text-sm">Establish a new division for collective operations.</p>
                </div>
                
                <div class="p-8">
                    <form onsubmit="handleSquadRegister(event)" class="space-y-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Squadron Name</label>
                            <input type="text" required class="w-full px-4 py-3 rounded-lg bg-slate-50 border border-slate-200 focus:border-red-500 focus:ring-1 focus:ring-red-500 outline-none font-medium" placeholder="e.g. Cyberjaya Guardians">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Affiliation</label>
                            <select class="w-full px-4 py-3 rounded-lg bg-slate-50 border border-slate-200 focus:border-red-500 focus:ring-1 focus:ring-red-500 outline-none font-medium text-slate-700">
                                <option>Corporate Entity</option>
                                <option>University / College</option>
                                <option>NGO / Non-Profit</option>
                                <option>Community Group</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Est. Strength</label>
                            <input type="number" min="5" placeholder="Number of Members" class="w-full px-4 py-3 rounded-lg bg-slate-50 border border-slate-200 focus:border-red-500 focus:ring-1 focus:ring-red-500 outline-none font-medium">
                        </div>
                        <button type="submit" class="w-full bg-red-700 text-white py-4 rounded-lg font-bold uppercase tracking-wider shadow-lg shadow-red-100 hover:bg-red-800 transform transition hover:-translate-y-0.5">
                            Initialize Squad
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- === SECTIONS === -->

    <!-- HOME SECTION (RESTORED DESIGN) -->
    <div id="home" class="page-section fade-in">
        <main>
            <!-- Hero Section -->
            <section class="relative overflow-hidden pt-20 pb-20 lg:pt-32 lg:pb-32">
                <!-- Original Background Style -->
                <div class="absolute inset-0 z-0">
                    <img src="https://images.unsplash.com/photo-1615461066159-fea0960485d5?auto=format&fit=crop&q=80&w=2000" alt="Person Donating Blood" class="w-full h-full object-cover opacity-40">
                    <div class="absolute inset-0 bg-gradient-to-r from-white via-white/80 to-white/30"></div>
                </div>
                
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
                    <div class="lg:grid lg:grid-cols-12 lg:gap-16 items-center">
                        <div class="lg:col-span-7 text-center lg:text-left z-10">
                            <div class="inline-flex items-center px-4 py-2 rounded border border-red-200 bg-white/80 backdrop-blur-sm text-red-700 text-xs font-bold uppercase tracking-widest mb-8 animate-pulse shadow-sm">
                                <i class="fas fa-heartbeat mr-2"></i> Critical: O- Reserves Depleted
                            </div>
                            <h1 class="text-5xl sm:text-6xl lg:text-7xl font-black text-slate-900 tracking-tighter mb-8 leading-none drop-shadow-sm">
                                DEFEND THE <br/>
                                <span class="text-red-600">PULSE.</span>
                            </h1>
                            <p class="text-xl text-slate-800 font-medium mb-10 leading-relaxed max-w-2xl mx-auto lg:mx-0">
                                Malaysia needs heroes. Your donation shields the vulnerable in our community. Join the BloodKnights of Malaysia today.
                            </p>
                            <div class="flex flex-col sm:flex-row gap-5 justify-center lg:justify-start">
                                <button onclick="navigateTo('donate')" class="animate-pulse-red bg-red-700 text-white hover:bg-red-800 shadow-xl shadow-red-200 px-6 py-3 rounded-lg font-bold uppercase tracking-wider text-sm transition-all transform hover:-translate-y-0.5">
                                    <i class="fas fa-khanda mr-2"></i> Accept Mission
                                </button>
                                <button onclick="navigateTo('eligibility')" class="bg-white/80 backdrop-blur text-slate-600 border border-slate-300 hover:text-slate-900 hover:border-slate-400 px-6 py-3 rounded-lg font-bold uppercase tracking-wider text-sm transition-all">
                                    <i class="fas fa-shield-alt mr-2"></i> Verify Status
                                </button>
                            </div>
                            
                            <!-- Restored Stats Row -->
                            <div class="mt-16 grid grid-cols-3 gap-8 border-t border-slate-200/60 pt-8">
                                <div>
                                    <p class="text-3xl font-black text-slate-900">50k+</p>
                                    <p class="text-xs text-slate-600 uppercase tracking-widest mt-1 font-bold">Knights</p>
                                </div>
                                <div>
                                    <p class="text-3xl font-black text-slate-900">120k+</p>
                                    <p class="text-xs text-slate-600 uppercase tracking-widest mt-1 font-bold">Lives Saved</p>
                                </div>
                                <div>
                                    <p class="text-3xl font-black text-slate-900">150+</p>
                                    <p class="text-xs text-slate-600 uppercase tracking-widest mt-1 font-bold">Strongholds</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Original Hero Card Style -->
                        <div class="lg:col-span-5 mt-16 lg:mt-0 relative">
                            <div class="relative rounded-2xl bg-white border border-slate-200 p-3 shadow-2xl rotate-3 hover:rotate-0 transition-transform duration-500">
                                <div class="absolute -inset-1 bg-gradient-to-br from-red-600 to-red-400 rounded-2xl blur opacity-20"></div>
                                <div class="relative rounded-xl overflow-hidden aspect-[4/5] group">
                                    <img src="https://images.unsplash.com/photo-1615461066841-6116e61058f4?auto=format&fit=crop&q=80&w=1000" alt="Heroic Blood Donor" class="object-cover w-full h-full transition-transform duration-700 group-hover:scale-105">
                                    <div class="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-slate-900/90 to-transparent text-white">
                                        <p class="font-bold text-lg">Guardian Amirul</p>
                                        <p class="text-xs text-slate-300 uppercase tracking-widest">Donated at PDN 5 mins ago</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Vanguard Gallery (Original + Functional) -->
            <section class="py-24 bg-white relative border-t border-slate-100">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="text-center mb-16">
                        <h2 class="text-4xl font-black text-slate-900 uppercase tracking-tight mb-4">The Vanguard</h2>
                        <p class="text-slate-500 max-w-2xl mx-auto">Real heroes don't wear capes. Select a division below to view active operations.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        <!-- Community Drive Card -->
                        <div onclick="navigateTo('community')" class="group relative rounded-2xl overflow-hidden shadow-lg aspect-[4/3] image-card-hover cursor-pointer">
                            <img src="https://images.unsplash.com/photo-1559027615-cd4628902d4a?auto=format&fit=crop&q=80&w=800" class="object-cover w-full h-full group-hover:scale-110 transition-transform duration-700">
                            <div class="absolute inset-0 bg-slate-900/40 group-hover:bg-slate-900/20 transition-colors"></div>
                            <div class="absolute bottom-0 left-0 p-6 w-full">
                                <span class="px-3 py-1 bg-red-600 text-white text-xs font-bold uppercase tracking-widest rounded mb-3 inline-block shadow-sm">Squadron Alpha</span>
                                <h3 class="text-white font-bold text-2xl uppercase mb-1">Community Drive</h3>
                                <p class="text-slate-200 text-sm opacity-0 group-hover:opacity-100 transition-opacity transform translate-y-2 group-hover:translate-y-0">Leaderboards & Events</p>
                            </div>
                        </div>

                        <!-- Care & Comfort Card -->
                        <div onclick="navigateTo('care')" class="group relative rounded-2xl overflow-hidden shadow-lg aspect-[4/3] image-card-hover cursor-pointer">
                            <img src="https://images.unsplash.com/photo-1579154204601-01588f351e67?auto=format&fit=crop&q=80&w=800" class="object-cover w-full h-full group-hover:scale-110 transition-transform duration-700">
                            <div class="absolute inset-0 bg-slate-900/40 group-hover:bg-slate-900/20 transition-colors"></div>
                            <div class="absolute bottom-0 left-0 p-6 w-full">
                                <span class="px-3 py-1 bg-blue-600 text-white text-xs font-bold uppercase tracking-widest rounded mb-3 inline-block shadow-sm">Support Unit</span>
                                <h3 class="text-white font-bold text-2xl uppercase mb-1">Care & Comfort</h3>
                                <p class="text-slate-200 text-sm opacity-0 group-hover:opacity-100 transition-opacity transform translate-y-2 group-hover:translate-y-0">Volunteer & Medics</p>
                            </div>
                        </div>

                        <!-- Recruitment Card -->
                        <div onclick="navigateTo('recruitment')" class="group relative rounded-2xl overflow-hidden shadow-lg aspect-[4/3] image-card-hover cursor-pointer md:col-span-2 lg:col-span-1">
                            <img src="https://images.unsplash.com/photo-1544027993-37dbfe43562a?auto=format&fit=crop&q=80&w=800" class="object-cover w-full h-full group-hover:scale-110 transition-transform duration-700">
                            <div class="absolute inset-0 bg-slate-900/40 group-hover:bg-slate-900/20 transition-colors"></div>
                            <div class="absolute bottom-0 left-0 p-6 w-full">
                                <span class="px-3 py-1 bg-green-600 text-white text-xs font-bold uppercase tracking-widest rounded mb-3 inline-block shadow-sm">Rank Up</span>
                                <h3 class="text-white font-bold text-2xl uppercase mb-1">New Hope</h3>
                                <p class="text-slate-200 text-sm opacity-0 group-hover:opacity-100 transition-opacity transform translate-y-2 group-hover:translate-y-0">View Progression</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Locate A Drive Section (Restored) -->
            <section class="py-24 bg-white text-slate-900 relative overflow-hidden border-t border-slate-100">
                <div class="absolute inset-0 opacity-30 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-red-50 via-white to-white"></div>
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
                    <div class="lg:grid lg:grid-cols-2 gap-16 items-center">
                        <div>
                            <div class="inline-flex items-center px-3 py-1 rounded bg-red-50 text-red-700 text-xs font-bold uppercase tracking-widest mb-6 border border-red-100">
                                <i class="fas fa-map-marker-alt mr-2"></i> Active Operations
                            </div>
                            <h2 class="text-4xl font-black tactical-font uppercase tracking-tight mb-6">Locate A Drive</h2>
                            <p class="text-slate-500 text-lg mb-8">Mobile units are active across the Klang Valley and beyond. Find a deployment sector near you.</p>
                            
                            <div class="bg-slate-50 p-2 rounded-xl border border-slate-200 flex flex-col sm:flex-row gap-2 mb-8 shadow-sm">
                                <input type="text" placeholder="Enter Postcode (e.g., 50450)" class="flex-1 bg-transparent border-none text-slate-900 placeholder-slate-400 px-4 py-3 focus:ring-0 outline-none w-full font-medium">
                                <button onclick="navigateTo('donate')" class="bg-red-700 text-white hover:bg-red-800 px-6 py-3 rounded-lg font-bold uppercase tracking-wider text-sm w-full sm:w-auto transition-colors">
                                    <i class="fas fa-check-circle mr-2"></i> Scan Sector
                                </button>
                            </div>

                            <div class="space-y-4">
                                <p class="text-sm font-bold uppercase tracking-widest text-slate-400">Upcoming Deployments</p>
                                <!-- Drive Items -->
                                <div class="flex items-center p-4 rounded-lg bg-white border border-slate-200 hover:border-red-300 hover:shadow-md transition-all cursor-pointer group" onclick="navigateTo('donate')">
                                    <div class="h-12 w-12 bg-red-50 rounded-lg flex items-center justify-center mr-4 border border-red-100 group-hover:border-red-200 transition-colors">
                                        <i class="fas fa-calendar text-red-600 text-lg"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-slate-900">Universiti Malaya Campaign</h4>
                                        <p class="text-sm text-slate-500">Dewan Tunku Canselor, KL</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="block font-bold text-slate-900">Oct 24</span>
                                        <span class="text-xs text-slate-500">09:00 - 15:00</span>
                                    </div>
                                </div>
                                <div class="flex items-center p-4 rounded-lg bg-white border border-slate-200 hover:border-red-300 hover:shadow-md transition-all cursor-pointer group" onclick="navigateTo('donate')">
                                    <div class="h-12 w-12 bg-red-50 rounded-lg flex items-center justify-center mr-4 border border-red-100 group-hover:border-red-200 transition-colors">
                                        <i class="fas fa-calendar text-red-600 text-lg"></i>
                                    </div>
                                    <div class="flex-1">
                                        <h4 class="font-bold text-slate-900">Cyberjaya Tech Hub</h4>
                                        <p class="text-sm text-slate-500">Prima Avenue Hall</p>
                                    </div>
                                    <div class="text-right">
                                        <span class="block font-bold text-slate-900">Oct 26</span>
                                        <span class="text-xs text-slate-500">10:00 - 16:00</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Map Placeholder -->
                        <div class="hidden lg:block relative h-full min-h-[500px] rounded-2xl overflow-hidden border border-slate-200 shadow-2xl bg-slate-50">
                            <div class="absolute inset-0 bg-slate-100">
                                <div class="absolute inset-0" style="background-image: linear-gradient(rgba(0,0,0,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0,0,0,0.05) 1px, transparent 1px); background-size: 40px 40px;"></div>
                                <div class="absolute top-1/4 left-1/4 animate-pulse">
                                    <div class="w-4 h-4 bg-red-600 rounded-full shadow-[0_0_20px_rgba(220,38,38,0.4)]"></div>
                                    <div class="absolute -inset-4 border border-red-600/30 rounded-full animate-ping"></div>
                                </div>
                                <div class="absolute top-1/2 right-1/3"><div class="w-3 h-3 bg-slate-300 rounded-full"></div></div>
                                <div class="absolute bottom-1/3 left-1/3"><div class="w-3 h-3 bg-slate-300 rounded-full"></div></div>
                                <div class="absolute bottom-6 left-6 bg-white/90 backdrop-blur px-4 py-3 rounded border border-slate-200 shadow-sm">
                                    <p class="text-xs text-slate-500 uppercase tracking-widest">Klang Valley Status</p>
                                    <p class="text-red-600 font-bold">3 Units Active</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- COMMUNITY SECTION (New) -->
    <div id="community" class="page-section hidden-section fade-in">
        <div class="max-w-7xl mx-auto px-4 py-20">
            <div class="text-center mb-12">
                <span class="text-red-600 font-bold tracking-widest uppercase text-sm">Squadron Alpha</span>
                <h2 class="text-4xl font-black tactical-font text-slate-900 uppercase mt-2">Top Battalions</h2>
                <p class="text-slate-500 mt-4 max-w-2xl mx-auto">Join a squadron. Compete for glory. Save lives together.</p>
            </div>

            <div class="grid md:grid-cols-3 gap-8 mb-16">
                <!-- Top Squad 1 -->
                <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-yellow-500 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-10 text-yellow-500"><i class="fas fa-crown text-6xl"></i></div>
                    <div class="flex items-center mb-4">
                        <span class="text-4xl font-black text-yellow-500 mr-4">01</span>
                        <div>
                            <h3 class="font-bold text-lg uppercase">Red Crescent Elite</h3>
                            <p class="text-sm text-slate-500">Kuala Lumpur Div</p>
                        </div>
                    </div>
                    <div class="bg-slate-100 rounded-lg p-4 flex justify-between items-center">
                        <span class="text-xs font-bold uppercase text-slate-500">Monthly Donations</span>
                        <span class="font-black text-2xl text-slate-900">4,250L</span>
                    </div>
                </div>
                <!-- Top Squad 2 -->
                <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-slate-400 relative overflow-hidden">
                     <div class="absolute top-0 right-0 p-4 opacity-10 text-slate-500"><i class="fas fa-medal text-6xl"></i></div>
                    <div class="flex items-center mb-4">
                        <span class="text-4xl font-black text-slate-400 mr-4">02</span>
                        <div>
                            <h3 class="font-bold text-lg uppercase">UniMalaya Heroes</h3>
                            <p class="text-sm text-slate-500">Campus Div</p>
                        </div>
                    </div>
                    <div class="bg-slate-100 rounded-lg p-4 flex justify-between items-center">
                        <span class="text-xs font-bold uppercase text-slate-500">Monthly Donations</span>
                        <span class="font-black text-2xl text-slate-900">3,890L</span>
                    </div>
                </div>
                <!-- Top Squad 3 -->
                <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-orange-700 relative overflow-hidden">
                     <div class="absolute top-0 right-0 p-4 opacity-10 text-orange-700"><i class="fas fa-medal text-6xl"></i></div>
                    <div class="flex items-center mb-4">
                        <span class="text-4xl font-black text-orange-700 mr-4">03</span>
                        <div>
                            <h3 class="font-bold text-lg uppercase">Cyberjaya Techs</h3>
                            <p class="text-sm text-slate-500">Corp Div</p>
                        </div>
                    </div>
                    <div class="bg-slate-100 rounded-lg p-4 flex justify-between items-center">
                        <span class="text-xs font-bold uppercase text-slate-500">Monthly Donations</span>
                        <span class="font-black text-2xl text-slate-900">2,100L</span>
                    </div>
                </div>
            </div>

            <div class="bg-slate-900 rounded-3xl p-8 md:p-12 relative overflow-hidden text-white">
                <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"></div>
                <div class="relative z-10 flex flex-col md:flex-row items-center justify-between gap-8">
                    <div>
                        <h3 class="text-2xl font-bold uppercase mb-2">Host a Drive</h3>
                        <p class="text-slate-400 max-w-md">Does your organization have what it takes? Register your squad and request a mobile unit deployment.</p>
                    </div>
                    <button onclick="openSquadModal()" class="bg-white text-slate-900 hover:bg-red-500 hover:text-white px-8 py-4 rounded-lg font-bold uppercase tracking-wider transition-all">
                        Register Squad
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- CARE & COMFORT SECTION (New) -->
    <div id="care" class="page-section hidden-section fade-in">
        <div class="max-w-7xl mx-auto px-4 py-20">
            <div class="grid lg:grid-cols-12 gap-12">
                <div class="lg:col-span-4">
                    <h2 class="text-4xl font-black tactical-font text-slate-900 uppercase mb-6">Support Unit</h2>
                    <p class="text-slate-600 mb-8 leading-relaxed">
                        Not everyone can donate blood, but everyone can serve. Join the support unit to manage logistics, comfort donors, and run the events.
                    </p>
                    <div class="bg-blue-50 border border-blue-100 p-6 rounded-xl mb-6">
                        <h4 class="font-bold text-blue-900 uppercase text-sm mb-2"><i class="fas fa-user-nurse mr-2"></i> Roles Available</h4>
                        <ul class="space-y-2 text-sm text-blue-800">
                            <li>• Post-Donation Care (Snacks & Observation)</li>
                            <li>• Registration Desk Officer</li>
                            <li>• Crowd Control Specialist</li>
                        </ul>
                    </div>
                    <button class="w-full bg-slate-900 text-white py-4 rounded-lg font-bold uppercase tracking-wider hover:bg-slate-800 transition-all">
                        Apply as Volunteer
                    </button>
                </div>
                <div class="lg:col-span-8">
                    <div class="grid sm:grid-cols-2 gap-6">
                        <!-- Vol Card 1 -->
                        <div class="bg-white border border-slate-200 p-6 rounded-xl hover:shadow-lg transition-all group cursor-pointer">
                            <div class="flex justify-between items-start mb-4">
                                <div class="h-12 w-12 bg-green-100 rounded-full flex items-center justify-center text-green-600">
                                    <i class="fas fa-clipboard-list"></i>
                                </div>
                                <span class="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded">Open</span>
                            </div>
                            <h3 class="font-bold text-lg mb-1 group-hover:text-green-700 transition-colors">Registration Officer</h3>
                            <p class="text-xs text-slate-400 uppercase tracking-widest mb-4">Dataran Merdeka • Oct 28</p>
                            <p class="text-slate-600 text-sm">Manage donor intake forms and verify eligibility status at the front desk.</p>
                        </div>
                        <!-- Vol Card 2 -->
                        <div class="bg-white border border-slate-200 p-6 rounded-xl hover:shadow-lg transition-all group cursor-pointer">
                            <div class="flex justify-between items-start mb-4">
                                <div class="h-12 w-12 bg-orange-100 rounded-full flex items-center justify-center text-orange-600">
                                    <i class="fas fa-coffee"></i>
                                </div>
                                <span class="bg-orange-100 text-orange-800 text-xs font-bold px-2 py-1 rounded">Urgent</span>
                            </div>
                            <h3 class="font-bold text-lg mb-1 group-hover:text-orange-700 transition-colors">Recovery Aide</h3>
                            <p class="text-xs text-slate-400 uppercase tracking-widest mb-4">Mid Valley • Oct 25</p>
                            <p class="text-slate-600 text-sm">Monitor donors in the resting area and distribute refreshments.</p>
                        </div>
                         <!-- Vol Card 3 -->
                         <div class="bg-white border border-slate-200 p-6 rounded-xl hover:shadow-lg transition-all group cursor-pointer">
                            <div class="flex justify-between items-start mb-4">
                                <div class="h-12 w-12 bg-purple-100 rounded-full flex items-center justify-center text-purple-600">
                                    <i class="fas fa-bullhorn"></i>
                                </div>
                                <span class="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded">Open</span>
                            </div>
                            <h3 class="font-bold text-lg mb-1 group-hover:text-purple-700 transition-colors">Drive Promoter</h3>
                            <p class="text-xs text-slate-400 uppercase tracking-widest mb-4">Sunway Pyramid • Nov 02</p>
                            <p class="text-slate-600 text-sm">Engage with the public and encourage walk-in signups.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RECRUITMENT / PROFILE SECTION (New) -->
    <div id="recruitment" class="page-section hidden-section fade-in">
        <div class="bg-slate-900 text-white pb-24 pt-20">
             <div class="max-w-7xl mx-auto px-4 text-center">
                 <div class="w-24 h-24 bg-slate-800 rounded-full mx-auto mb-6 border-4 border-red-600 flex items-center justify-center relative">
                     <i class="fas fa-user-astronaut text-4xl"></i>
                     <div class="absolute -bottom-2 bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wider">Lvl 4</div>
                 </div>
                 <h2 class="text-3xl font-black tactical-font uppercase mb-2" id="profile-name">Guest User</h2>
                 <p class="text-slate-400">Member ID: BK-8821-ALPHA</p>
             </div>
        </div>
        
        <div class="max-w-5xl mx-auto px-4 -mt-12 relative z-10">
            <div class="bg-white rounded-2xl shadow-xl border border-slate-200 p-8 mb-8">
                <div class="flex justify-between items-center mb-8 border-b border-slate-100 pb-4">
                    <h3 class="text-xl font-bold uppercase text-slate-900">Service Record</h3>
                    <button class="text-red-600 text-sm font-bold uppercase hover:text-red-800">View Full History</button>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
                    <div>
                        <p class="text-4xl font-black text-slate-900">3</p>
                        <p class="text-xs text-slate-500 uppercase font-bold tracking-widest mt-2">Donations</p>
                    </div>
                    <div>
                        <p class="text-4xl font-black text-slate-900">9</p>
                        <p class="text-xs text-slate-500 uppercase font-bold tracking-widest mt-2">Lives Saved</p>
                    </div>
                    <div>
                        <p class="text-4xl font-black text-slate-900">12</p>
                        <p class="text-xs text-slate-500 uppercase font-bold tracking-widest mt-2">XP Gained</p>
                    </div>
                    <div>
                        <p class="text-4xl font-black text-slate-900">Next</p>
                        <p class="text-xs text-slate-500 uppercase font-bold tracking-widest mt-2">Dec 14</p>
                    </div>
                </div>
            </div>

            <!-- Rank Progression -->
            <h3 class="text-lg font-bold uppercase text-slate-500 mb-6 pl-2">Progression Path</h3>
            <div class="space-y-4">
                <!-- Rank 1 -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 flex items-center opacity-100 border-l-4 border-l-slate-800">
                    <div class="h-12 w-12 rounded-full bg-slate-800 text-white flex items-center justify-center font-bold mr-6"><i class="fas fa-check"></i></div>
                    <div class="flex-1">
                        <h4 class="font-bold text-slate-900 uppercase">Recruit</h4>
                        <p class="text-sm text-slate-500">Register and complete first health screening.</p>
                    </div>
                </div>
                <!-- Rank 2 -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 flex items-center border-l-4 border-l-red-600 shadow-md transform scale-105">
                    <div class="h-12 w-12 rounded-full bg-red-600 text-white flex items-center justify-center font-bold mr-6">2</div>
                    <div class="flex-1">
                        <div class="flex justify-between mb-1">
                            <h4 class="font-bold text-slate-900 uppercase">Guardian</h4>
                            <span class="text-xs font-bold text-red-600">Current Rank</span>
                        </div>
                        <p class="text-sm text-slate-500 mb-2">Complete 1 successful donation.</p>
                        <div class="w-full bg-slate-100 rounded-full h-1.5">
                            <div class="bg-red-600 h-1.5 rounded-full" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
                <!-- Rank 3 -->
                <div class="bg-white p-6 rounded-xl border border-slate-200 flex items-center opacity-60 grayscale">
                    <div class="h-12 w-12 rounded-full bg-slate-200 text-slate-500 flex items-center justify-center font-bold mr-6">3</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-slate-900 uppercase">BloodKnight</h4>
                        <p class="text-sm text-slate-500">Complete 5 successful donations.</p>
                    </div>
                    <i class="fas fa-lock text-slate-300"></i>
                </div>
                <!-- Rank 4 -->
                 <div class="bg-white p-6 rounded-xl border border-slate-200 flex items-center opacity-60 grayscale">
                    <div class="h-12 w-12 rounded-full bg-slate-200 text-slate-500 flex items-center justify-center font-bold mr-6">4</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-slate-900 uppercase">Paladin</h4>
                        <p class="text-sm text-slate-500">Complete 10 successful donations + 1 Volunteer Event.</p>
                    </div>
                    <i class="fas fa-lock text-slate-300"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- ELIGIBILITY SECTION -->
    <div id="eligibility" class="page-section hidden-section fade-in">
        <div class="max-w-7xl mx-auto px-4 py-20">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-black tactical-font text-slate-900 uppercase tracking-tight">Status Check</h2>
                <div class="h-1 w-20 bg-red-600 mx-auto mt-6 rounded-full"></div>
                <p class="mt-4 text-slate-500">Automated Pre-Screening Protocol</p>
            </div>
            
            <div class="glass-panel rounded-2xl p-8 max-w-2xl mx-auto" id="quiz-container">
                <!-- Content rendered by JS -->
            </div>
        </div>
    </div>

    <!-- SUPPLY SECTION -->
    <div id="supply" class="page-section hidden-section fade-in">
        <div class="max-w-7xl mx-auto px-4 py-20">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-black tactical-font text-slate-900 uppercase tracking-tight">Armory Reserves</h2>
                <p class="mt-4 text-slate-500">Live telemetry from Pusat Darah Negara database.</p>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" id="supply-grid">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- DONATE SECTION -->
    <div id="donate" class="page-section hidden-section fade-in">
        <div class="max-w-7xl mx-auto px-4 py-12 sm:py-20">
            <div class="lg:flex gap-12">
                <div class="lg:w-1/3 mb-12 lg:mb-0">
                    <h2 class="text-3xl font-black tactical-font text-slate-900 mb-6 uppercase">Locate Station</h2>
                    <p class="text-slate-500 mb-8">Identify the nearest collection point to begin your contribution.</p>
                    
                    <div class="relative mb-8 group">
                        <input type="text" placeholder="Postcode (e.g., 50480)" class="w-full pl-12 pr-4 py-4 rounded-lg bg-white border border-slate-200 text-slate-900 placeholder-slate-400 focus:border-red-600 focus:ring-1 focus:ring-red-600 outline-none transition-all shadow-sm font-medium">
                        <i class="fas fa-map-marker-alt absolute left-4 top-4 text-slate-400 w-5 h-5 pt-1"></i>
                    </div>

                    <div class="bg-red-50 p-8 rounded-xl border border-red-100 backdrop-blur-sm">
                        <h4 class="font-bold text-red-800 flex items-center mb-4 uppercase tracking-wider text-sm">
                            <i class="fas fa-shield-alt mr-2"></i> Mission Briefing
                        </h4>
                        <ul class="space-y-4 text-slate-600 text-sm">
                            <li class="flex items-start"><i class="fas fa-check-circle text-red-600 mt-1 mr-3"></i> Operation duration: 60 minutes.</li>
                            <li class="flex items-start"><i class="fas fa-check-circle text-red-600 mt-1 mr-3"></i> Bring MyKad/Passport.</li>
                            <li class="flex items-start"><i class="fas fa-check-circle text-red-600 mt-1 mr-3"></i> Light meal before donating.</li>
                        </ul>
                    </div>
                </div>

                <div class="lg:w-2/3">
                    <div class="grid gap-4" id="locations-grid">
                        <!-- Locations rendered via JS -->
                    </div>
                    <div class="mt-10 text-center">
                        <button class="text-slate-400 font-bold uppercase text-xs tracking-widest flex items-center justify-center mx-auto hover:text-red-600 transition-colors">
                            Expand Search Radius <i class="fas fa-chevron-right ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400 py-16 border-t border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-4 gap-12 mb-12">
                <div class="col-span-1 md:col-span-2">
                    <div class="flex items-center mb-6">
                        <i class="fas fa-shield-alt text-red-600 text-xl mr-2"></i>
                        <span class="text-xl font-black tactical-font text-white uppercase tracking-tighter">BloodKnight</span>
                    </div>
                    <p class="text-slate-500 max-w-xs leading-relaxed text-sm">
                        Defending the realm through sacrifice and solidarity. Join the ranks. Save the future.
                    </p>
                </div>
                <div>
                    <h4 class="text-white font-bold uppercase tracking-widest text-xs mb-6">Navigation</h4>
                    <ul class="space-y-3 text-sm">
                        <li><button onclick="navigateTo('home')" class="hover:text-red-500 transition-colors">Headquarters</button></li>
                        <li><button onclick="navigateTo('eligibility')" class="hover:text-red-500 transition-colors">Check Status</button></li>
                        <li><button onclick="navigateTo('donate')" class="hover:text-red-500 transition-colors">Find Station</button></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-white font-bold uppercase tracking-widest text-xs mb-6">Comms</h4>
                    <ul class="space-y-3 text-sm">
                        <li class="flex items-center hover:text-white transition-colors cursor-pointer"><i class="fas fa-phone mr-3 text-slate-600"></i> 1-800-88-LIFE</li>
                        <li class="flex items-center hover:text-white transition-colors cursor-pointer"><i class="fas fa-envelope mr-3 text-slate-600"></i> command@bloodknight.my</li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 z-50 px-6 py-4 rounded-lg shadow-xl flex items-center border backdrop-blur-md transition-all duration-300 transform translate-y-20 opacity-0">
        <i id="toast-icon" class="fas fa-check-circle mr-3"></i>
        <span id="toast-message" class="font-bold tracking-wide text-sm"></span>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- STATE ---
        let isLoggedIn = false;
        let userName = "Guest";

        // --- DATA ---
        const LOCATIONS = [
            { id: 1, name: 'Pusat Darah Negara', address: 'Jalan Tun Razak, Kuala Lumpur', distance: '0.8 km', nextSlot: 'Today, 14:00' },
            { id: 2, name: 'Mid Valley Donation Suite', address: 'Lingkaran Syed Putra, KL', distance: '5.4 km', nextSlot: 'Tomorrow, 10:00' },
            { id: 3, name: 'Hospital Kuala Lumpur', address: 'Jalan Pahang, Kuala Lumpur', distance: '3.1 km', nextSlot: 'Today, 16:15' },
            { id: 4, name: 'Sunway Pyramid Mobile', address: 'Blue Atrium, Petaling Jaya', distance: '12.0 km', nextSlot: 'Today, 11:00' },
        ];

        const BLOOD_LEVELS = [
            { type: 'A+', level: 80, status: 'Stable' },
            { type: 'A-', level: 30, status: 'Low Supply' },
            { type: 'B+', level: 65, status: 'Moderate' },
            { type: 'B-', level: 20, status: 'Critical' },
            { type: 'O+', level: 90, status: 'Stable' },
            { type: 'O-', level: 15, status: 'Critical' },
            { type: 'AB+', level: 70, status: 'Moderate' },
            { type: 'AB-', level: 40, status: 'Low Supply' },
        ];

        const QUESTIONS = [
            { text: "Are you at least 17 years of age, Recruit?", required: true },
            { text: "Is your weight above 45 kg (approx 100 lbs)?", required: true },
            { text: "Are you in peak health today (no fever/cough)?", required: true },
            { text: "Have you donated blood in the last 2-3 months?", required: false },
        ];

        // --- NAVIGATION ---
        function navigateTo(pageId) {
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Hide all sections
            document.querySelectorAll('.page-section').forEach(el => el.classList.add('hidden-section'));
            
            // Show target section
            const target = document.getElementById(pageId);
            if(target) target.classList.remove('hidden-section');

            // Update Nav State
            document.querySelectorAll('.nav-link').forEach(el => {
                if(el.dataset.target === pageId) {
                    el.classList.remove('text-slate-500');
                    el.classList.add('text-red-700');
                } else {
                    el.classList.add('text-slate-500');
                    el.classList.remove('text-red-700');
                }
            });
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // --- AUTH SYSTEM ---
        function openAuthModal() {
            document.getElementById('auth-modal').classList.remove('hidden');
        }

        function closeAuthModal() {
            document.getElementById('auth-modal').classList.add('hidden');
        }

        function switchAuthTab(tab) {
            const loginBtn = document.getElementById('tab-login');
            const regBtn = document.getElementById('tab-register');
            const regFields = document.getElementById('register-fields');
            const title = document.getElementById('auth-title');
            const btnText = document.getElementById('auth-btn-text');

            if(tab === 'register') {
                loginBtn.classList.remove('text-red-700', 'border-red-700', 'bg-white');
                loginBtn.classList.add('bg-slate-50', 'text-slate-400', 'border-slate-200');
                
                regBtn.classList.add('text-red-700', 'border-red-700', 'bg-white');
                regBtn.classList.remove('bg-slate-50', 'text-slate-400', 'border-slate-200');

                regFields.classList.remove('hidden');
                title.textContent = 'New Recruit';
                btnText.textContent = 'Register';
            } else {
                regBtn.classList.remove('text-red-700', 'border-red-700', 'bg-white');
                regBtn.classList.add('bg-slate-50', 'text-slate-400', 'border-slate-200');

                loginBtn.classList.add('text-red-700', 'border-red-700', 'bg-white');
                loginBtn.classList.remove('bg-slate-50', 'text-slate-400', 'border-slate-200');

                regFields.classList.add('hidden');
                title.textContent = 'Welcome Back';
                btnText.textContent = 'Identify';
            }
        }

        function handleAuth(e) {
            e.preventDefault();
            // Simulate Login
            const nameInput = document.getElementById('auth-name').value;
            userName = nameInput || "Commander";
            isLoggedIn = true;
            
            // Update UI
            updateAuthUI();
            
            // Close Modal
            closeAuthModal();
            showNotification(`Welcome back, ${userName}. Systems Online.`);
        }

        function updateAuthUI() {
            if(isLoggedIn) {
                // Desktop
                document.getElementById('btn-join-desktop').classList.add('hidden');
                document.getElementById('profile-desktop').classList.remove('hidden');
                document.getElementById('profile-desktop').classList.add('flex');
                document.getElementById('username-display-desktop').textContent = userName;

                // Mobile
                document.getElementById('btn-join-mobile').classList.add('hidden');
                document.getElementById('profile-mobile').classList.remove('hidden');
                document.getElementById('profile-mobile').classList.add('flex');
                document.getElementById('username-display-mobile').textContent = userName;
                document.getElementById('profile-name').textContent = userName;
            }
        }

        // --- SQUAD SYSTEM ---
        function openSquadModal() {
            if (!isLoggedIn) {
                showNotification("Authentication Required. Please Identify first.", "error");
                openAuthModal();
                return;
            }
            document.getElementById('squad-modal').classList.remove('hidden');
        }

        function closeSquadModal() {
            document.getElementById('squad-modal').classList.add('hidden');
        }

        function handleSquadRegister(e) {
            e.preventDefault();
            // Simulate API call
            setTimeout(() => {
                closeSquadModal();
                showNotification("Squadron registered successfully. Awaiting approval.", "success");
            }, 800);
        }

        // --- NOTIFICATIONS ---
        function showNotification(message, type = 'success') {
            const toast = document.getElementById('toast');
            const msgEl = document.getElementById('toast-message');
            const iconEl = document.getElementById('toast-icon');

            msgEl.textContent = message;
            
            if(type === 'success') {
                toast.className = "fixed bottom-4 right-4 z-50 px-6 py-4 rounded-lg shadow-xl flex items-center border backdrop-blur-md bg-green-50 text-green-800 border-green-200 transition-all duration-300";
                iconEl.className = "fas fa-check-circle mr-3 text-green-600";
            } else {
                toast.className = "fixed bottom-4 right-4 z-50 px-6 py-4 rounded-lg shadow-xl flex items-center border backdrop-blur-md bg-red-50 text-red-800 border-red-200 transition-all duration-300";
                iconEl.className = "fas fa-times-circle mr-3 text-red-600";
            }

            toast.classList.remove('translate-y-20', 'opacity-0');

            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // --- WIZARD LOGIC (Eligibility) ---
        let quizStep = 0;
        
        function renderQuiz() {
            const container = document.getElementById('quiz-container');
            if(quizStep >= QUESTIONS.length) {
                container.innerHTML = `
                    <div class="text-center py-8 animate-fade-in">
                        <div class="w-24 h-24 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-6 border border-green-100">
                            <i class="fas fa-check text-4xl text-green-600"></i>
                        </div>
                        <h3 class="text-2xl font-black tactical-font text-slate-900 mb-2 uppercase">Status: Eligible</h3>
                        <p class="text-slate-500 mb-8">You are cleared to proceed with the donation mission.</p>
                        <button onclick="navigateTo('donate')" class="bg-red-700 text-white hover:bg-red-800 shadow-lg shadow-red-200 border border-red-700 px-8 py-3 rounded-lg font-bold uppercase tracking-wider text-sm">Find a Station</button>
                        <button onclick="resetQuiz()" class="block mx-auto mt-6 text-sm text-slate-400 hover:text-slate-600 uppercase tracking-wide">Reset Scan</button>
                    </div>
                `;
                return;
            }

            if(quizStep === -1) {
                 container.innerHTML = `
                    <div class="text-center py-8 animate-fade-in">
                        <div class="w-24 h-24 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6 border border-red-100">
                            <i class="fas fa-times text-4xl text-red-600"></i>
                        </div>
                        <h3 class="text-2xl font-black tactical-font text-slate-900 mb-2 uppercase">Status: Deferred</h3>
                        <p class="text-slate-500 mb-8">Current parameters do not meet donation criteria.</p>
                        <div class="flex gap-4 justify-center">
                            <button onclick="resetQuiz()" class="bg-transparent text-slate-600 border border-slate-300 hover:border-slate-400 px-6 py-3 rounded-lg font-bold uppercase tracking-wider text-sm">Retry Scan</button>
                        </div>
                    </div>
                 `;
                 return;
            }

            const q = QUESTIONS[quizStep];
            const progress = Math.round((quizStep / QUESTIONS.length) * 100);
            
            container.innerHTML = `
                <div class="animate-fade-in">
                   <div class="mb-10">
                    <div class="flex justify-between text-xs font-bold text-slate-400 mb-2 uppercase tracking-wider">
                      <span>Protocol Step ${quizStep + 1} / ${QUESTIONS.length}</span>
                      <span>${progress}%</span>
                    </div>
                    <div class="w-full bg-slate-100 rounded-full h-2">
                      <div class="bg-red-600 h-2 rounded-full transition-all duration-300 shadow-sm" style="width: ${progress}%"></div>
                    </div>
                  </div>

                  <h3 class="text-2xl font-bold text-slate-800 mb-10 text-center min-h-[5rem] flex items-center justify-center leading-relaxed">
                    ${q.text}
                  </h3>

                  <div class="flex gap-6 justify-center">
                    <button onclick="handleAnswer(false)" class="flex-1 max-w-xs py-4 rounded-lg border border-slate-200 font-bold text-slate-500 hover:border-slate-400 hover:text-slate-800 hover:bg-slate-50 transition-all uppercase tracking-wider">
                      Negative
                    </button>
                    <button onclick="handleAnswer(true)" class="flex-1 max-w-xs py-4 rounded-lg bg-red-700 text-white font-bold hover:bg-red-800 shadow-lg shadow-red-200 transition-all uppercase tracking-wider">
                      Affirmative
                    </button>
                  </div>
                </div>
            `;
        }

        function handleAnswer(ans) {
            const q = QUESTIONS[quizStep];
            let disqualified = false;
            if (q.required && !ans) disqualified = true;
            if (!q.required && ans) disqualified = true;

            if(disqualified) {
                quizStep = -1;
            } else {
                quizStep++;
            }
            renderQuiz();
        }

        function resetQuiz() {
            quizStep = 0;
            renderQuiz();
        }

        // --- RENDER LISTS ---
        function attemptBooking(locationName) {
            if (!isLoggedIn) {
                showNotification("Authentication Required. Please Identify.", "error");
                openAuthModal();
            } else {
                showNotification(`Mission confirmed at ${locationName}. Dispatching orders.`);
            }
        }

        function renderLocations() {
            const grid = document.getElementById('locations-grid');
            grid.innerHTML = LOCATIONS.map(loc => `
                <div class="bg-white p-6 rounded-xl border border-slate-200 hover:border-red-300 hover:shadow-md transition-all group shadow-sm cursor-pointer" onclick="attemptBooking('${loc.name}')">
                    <div class="flex justify-between items-start mb-4">
                    <div>
                        <h4 class="text-xl font-bold tactical-font text-slate-900 group-hover:text-red-700 transition-colors uppercase">${loc.name}</h4>
                        <div class="flex items-center text-slate-500 mt-2 text-sm">
                        <i class="fas fa-map-marker-alt w-4 h-4 mr-2 text-red-600"></i>
                        ${loc.address}
                        </div>
                    </div>
                    <span class="bg-slate-100 text-slate-600 text-xs font-bold px-3 py-1 rounded border border-slate-200">
                        ${loc.distance}
                    </span>
                    </div>
                    
                    <div class="border-t border-slate-100 pt-4 flex items-center justify-between mt-4">
                    <div class="flex items-center text-green-700 text-sm font-bold">
                        <i class="fas fa-clock w-4 h-4 mr-2"></i>
                        ${loc.nextSlot}
                    </div>
                    <button class="text-red-600 hover:text-red-800 font-bold text-sm uppercase tracking-wider px-4 py-2 rounded hover:bg-red-50 transition-all">
                        Book Slot
                    </button>
                    </div>
                </div>
            `).join('');
        }

        function renderSupply() {
            const grid = document.getElementById('supply-grid');
            grid.innerHTML = BLOOD_LEVELS.map(blood => {
                let statusClass = 'bg-green-50 text-green-700 border border-green-100';
                let barColor = 'bg-green-600';
                
                if (blood.status === 'Moderate') {
                    statusClass = 'bg-yellow-50 text-yellow-700 border border-yellow-100';
                    barColor = 'bg-yellow-500';
                }
                if (blood.status === 'Low Supply') {
                    statusClass = 'bg-orange-50 text-orange-700 border border-orange-100';
                    barColor = 'bg-orange-600';
                }
                if (blood.status === 'Critical') {
                    statusClass = 'bg-red-50 text-red-700 border border-red-100';
                    barColor = 'bg-red-600';
                }

                return `
                <div class="bg-white p-6 rounded-xl border border-slate-200 hover:border-red-200 hover:shadow-lg transition-all relative overflow-hidden group shadow-sm">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-slate-50 rounded-bl-full -mr-10 -mt-10 transition-transform group-hover:scale-150"></div>
                    <div class="flex justify-between items-end mb-4 relative z-10">
                    <span class="text-5xl font-black tactical-font text-slate-900 tracking-tighter">${blood.type}</span>
                    <span class="text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wide ${statusClass}">
                        ${blood.status}
                    </span>
                    </div>
                    <div class="w-full bg-slate-200 rounded-full h-3 mt-3 overflow-hidden border border-slate-100">
                      <div class="${barColor} h-full rounded-full transition-all duration-1000 ease-out shadow-sm" style="width: ${blood.level}%"></div>
                    </div>
                </div>
                `;
            }).join('');
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            renderQuiz();
            renderLocations();
            renderSupply();
        });

    </script>
</body>
</html>